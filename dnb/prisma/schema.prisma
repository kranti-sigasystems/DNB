generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id               String      @id @db.Uuid
  first_name       String?
  last_name        String?
  email            String      @unique
  password         String
  roleId           Int
  subscriptionId   Int?
  stripeCustomerId String?
  businessName     String?
  created_at       DateTime?
  updated_at       DateTime?
  
  // Relations
  role          Role        @relation(fields: [roleId], references: [id])
  businessOwner BusinessOwner?
  payments      Payment[]
  subscriptions Subscription[]
  
  @@map("users")
}

model Role {
  id          Int     @id @default(autoincrement())
  name        String  @unique
  description String? @default("")
  isActive    Boolean @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  users       User[]
  
  @@map("roles")
}

model BusinessOwner {
  id                  String   @id @default(uuid()) @db.Uuid
  userId              String?  @db.Uuid @unique
  businessName        String
  first_name          String?
  last_name           String?
  email               String   @unique
  phoneNumber         String?
  registrationNumber  String?  @unique
  country             String
  state               String?
  city                String?
  address             String?
  postalCode          String?
  planId              String?  @db.Uuid
  paymentId           String?  @db.Uuid
  status              Status   @default(active)
  is_deleted          Boolean  @default(false)
  is_verified         Boolean  @default(false)
  is_approved         Boolean  @default(false)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  // Relations
  user        User?            @relation(fields: [userId], references: [id])
  plan        Plan?            @relation(fields: [planId], references: [id])
  // payment     Payment?         @relation(fields: [paymentId], references: [id], name: "BusinessOwnerPayment")
  buyers      Buyer[]
  offers      Offer[]
  countries   Country[]
  locations   Location[]
  products    Product[]
  offerResults OfferResult[]
  offerBuyers OfferBuyer[]
  offerDrafts OfferDraft[]
  
  @@map("business_owners")
}

model Buyer {
  id                  String   @id @default(uuid()) @db.Uuid
  ownerId             String   @db.Uuid @map("owner_id")
  buyersCompanyName   String   @map("buyers_company_name")
  registrationNumber  String?  @unique @map("registration_number")
  taxId               String?  @map("tax_id")
  contactName         String   @map("contact_name")
  contactEmail        String   @map("contact_email")
  countryCode         String   @map("country_code")
  contactPhone        String?  @map("contact_phone")
  country             String
  productName         String   @map("product_name")
  locationName        String   @map("location_name")
  state               String?
  city                String?
  address             String?
  postalCode          String?  @map("postal_code")
  status              BuyerStatus @default(active)
  isVerified          Boolean  @default(false) @map("is_verified")
  isDeleted           Boolean  @default(false) @map("is_deleted")
  
  // Relations
  businessOwner BusinessOwner @relation(fields: [ownerId], references: [id], map: "buyers_owner_id_fkey")
  offerBuyers   OfferBuyer[]
  offerVersions OfferVersion[]
  offerResults  OfferResult[]
  offers      Offer[]
  
  @@map("buyers")
}

model Country {
  id        String   @id @default(uuid()) @db.Uuid
  code      String   @unique
  name      String   @unique
  ownerId   String   @db.Uuid @map("owner_id")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relations
  businessOwner BusinessOwner @relation(fields: [ownerId], references: [id])
  locations     Location[]
  
  @@map("countries")
}

model Location {
  id        String   @id @default(uuid()) @db.Uuid
  ownerId   String   @db.Uuid @map("owner_id")
  city      String
  state     String
  code      String   @unique
  countryId String   @db.Uuid @map("country_id")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relations
  businessOwner BusinessOwner @relation(fields: [ownerId], references: [id])
  country       Country       @relation(fields: [countryId], references: [id])
  
  @@map("locations")
}

model Offer {
  id                  Int       @id @default(autoincrement())
  businessOwnerId     String    @db.Uuid @map("business_owner_id")
  offerName           String    @map("offer_name")
  businessName        String    @map("business_name")
  fromParty           String    @map("from_party")
  toParty             String    @map("to_party")
  buyerId             String?   @db.Uuid @map("buyer_id")
  origin              String
  processor           String?
  plantApprovalNumber String    @map("plant_approval_number")
  destination         String
  brand               String
  draftName           String?   @map("draft_name")
  offerValidityDate   DateTime  @map("offer_validity_date")
  shipmentDate        DateTime? @map("shipment_date")
  grandTotal          Float?    @map("grand_total")
  quantity            String?
  tolerance           String?
  paymentTerms        String?   @map("payment_terms")
  remark              String?
  status              OfferStatus @default(open)
  isDeleted           Boolean   @default(false) @map("is_deleted")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  
  // Relations
  businessOwner BusinessOwner @relation(fields: [businessOwnerId], references: [id])
  buyer         Buyer?        @relation(fields: [buyerId], references: [id])
  products      OfferProduct[]
  offerBuyers   OfferBuyer[]
  versions      OfferVersion[]
  results       OfferResult[]
  
  @@map("offers")
}

model OfferBuyer {
  id        String   @id @default(uuid()) @db.Uuid
  offerId   Int      @map("offer_id")
  buyerId   String   @db.Uuid @map("buyer_id")
  ownerId   String   @db.Uuid @map("owner_id")
  status    String   @default("open")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relations
  offer      Offer          @relation(fields: [offerId], references: [id])
  buyer      Buyer          @relation(fields: [buyerId], references: [id])
  owner      BusinessOwner? @relation(fields: [ownerId], references: [id])
  offerVersions OfferVersion[]
  
  @@unique([offerId, buyerId])
  @@map("offer_buyers")
}

model OfferDraft {
  draftNo              Int       @id @default(autoincrement())
  businessOwnerId      String    @db.Uuid
  fromParty            String    @map("from_party")
  origin               String
  processor            String?
  plantApprovalNumber  String    @map("plant_approval_number")
  brand                String
  draftName            String?   @map("draft_name")
  offerValidityDate    DateTime? @map("offer_validity_date")
  shipmentDate         DateTime? @map("shipment_date")
  quantity             String?
  tolerance            String?
  paymentTerms         String?   @map("payment_terms")
  remark               String?
  grandTotal           Decimal?  @db.Decimal(15, 2) @map("grand_total")
  status               DraftStatus @default(open)
  isDeleted            Boolean   @default(false) @map("is_deleted")
  deletedAt            DateTime? @map("deleted_at")
  createdAt            DateTime  @default(now()) @map("created_at")
  updatedAt            DateTime  @updatedAt @map("updated_at")
  
  // Relations
  businessOwner    BusinessOwner     @relation(fields: [businessOwnerId], references: [id])
  draftProducts    OfferDraftProduct[]
  products         Product[]
  
  @@map("offers_draft")
}

model OfferDraftProduct {
  id             String   @id @default(uuid()) @db.Uuid
  draftNo        Int
  productId      String   @db.Uuid @map("product_id")
  productName    String   @map("product_name")
  species        String
  sizeDetails    String?  @map("size_details")
  breakupDetails String?  @map("breakup_details")
  priceDetails   String?  @map("price_details")
  packing        String?
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  
  // Relations
  offerDraft     OfferDraft @relation(fields: [draftNo], references: [draftNo])
  sizeBreakups   SizeBreakup[]
  
  @@map("offer_draft_products")
}

model OfferProduct {
  id              String   @id @default(uuid()) @db.Uuid
  offerId         Int      @map("offer_id")
  productId       String   @db.Uuid @map("product_id")
  productName     String   @map("product_name")
  species         String
  sizeDetails     String?  @map("size_details")
  conditionDetails String? @map("condition_details")
  breakupDetails  String?  @map("breakup_details")
  priceDetails    String?  @map("price_details")
  packing         String?
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  // Relations
  offer          Offer           @relation(fields: [offerId], references: [id])
  sizeBreakups   OfferSizeBreakup[]
  
  @@map("offer_products")
}

model OfferResult {
  id                Int      @id @default(autoincrement())
  offerVersionId    Int      @map("offer_version_id")
  offerId           Int      @map("offer_id")
  ownerId           String   @db.Uuid @map("owner_id")
  buyerId           String   @db.Uuid @map("buyer_id")
  isAccepted        Boolean? @map("is_accepted")
  acceptedBy        String?  @map("accepted_by")
  isRejected        Boolean? @map("is_rejected")
  rejectedBy        String?  @map("rejected_by")
  ownerCompanyName  String   @map("owner_company_name")
  buyerCompanyName  String   @map("buyer_company_name")
  ownerName         String   @map("owner_name")
  buyerName         String   @map("buyer_name")
  offerName         String   @default("Unnamed offer") @map("offer_name")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  // Relations
  offerVersion OfferVersion   @relation(fields: [offerVersionId], references: [id])
  offer        Offer          @relation(fields: [offerId], references: [id])
  owner        BusinessOwner  @relation(fields: [ownerId], references: [id])
  buyer        Buyer          @relation(fields: [buyerId], references: [id])
  
  @@map("offer_result")
}

model OfferSizeBreakup {
  id            String   @id @default(uuid()) @db.Uuid
  offerProductId String  @db.Uuid @map("offer_product_id")
  size          String?
  breakup       Float?
  price         String?
  condition     String?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  
  // Relations
  offerProduct OfferProduct @relation(fields: [offerProductId], references: [id])
  
  @@map("offer_size_breakups")
}

model OfferVersion {
  id                  Int      @id @default(autoincrement())
  buyerId             String   @db.Uuid @map("buyer_id")
  offerId             Int      @map("offer_id")
  offerName           String   @map("offer_name")
  versionNo           Int      @map("version_no")
  fromParty           String   @map("from_party")
  toParty             String?  @map("to_party")
  productName         String   @map("product_name")
  speciesName         String   @map("species_name")
  brand               String
  plantApprovalNumber String   @map("plant_approval_number")
  quantity            String?
  tolerance           String?
  paymentTerms        String?  @map("payment_terms")
  sizeBreakups        Json     @default("[]") @map("size_breakups")
  grandTotal          Float?   @map("grand_total")
  shipmentDate        DateTime? @map("shipment_date")
  remark              String?
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  
  // Relations
  buyer        Buyer         @relation(fields: [buyerId], references: [id])
  offer        Offer         @relation(fields: [offerId], references: [id])
  offerBuyer   OfferBuyer?   @relation(fields: [offerId, buyerId], references: [offerId, buyerId])
  results      OfferResult[]
  
  @@map("offer_versions")
  
  @@unique([offerId, buyerId])
}

model PasswordResetOtp {
  id        String   @id @default(uuid()) @db.Uuid
  email     String
  otp       String
  expiresAt DateTime @map("expires_at")
  used      Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  @@map("password_reset_otps")
}

model Payment {
  id              String    @id @default(uuid()) @db.Uuid
  userId          String    @db.Uuid @map("user_id")
  businessOwnerId String?   @db.Uuid @map("business_owner_id")
  planId          String    @db.Uuid @map("plan_id")
  amount          Float
  currency        String    @default("INR")
  status          PaymentStatus @default(pending)
  paymentMethod   PaymentMethod @default(card) @map("payment_method")
  transactionId   String    @unique @map("transaction_id")
  subscriptionId  String?   @map("subscription_id")
  invoicePdf      String?   @map("invoice_pdf")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  
  // Relations
  user           User           @relation(fields: [userId], references: [id])
  plan           Plan           @relation(fields: [planId], references: [id])
  // businessOwner  BusinessOwner? @relation(fields: [businessOwnerId], references: [id])
  
  @@map("payments")
}

model Plan {
  id                    String    @id @default(uuid()) @db.Uuid
  key                   PlanKey
  name                  String
  description           String?   @default("")
  currency              String    @default("INR")
  billingCycle          BillingCycle @default(monthly) @map("billing_cycle")
  stripeProductId       String?   @map("stripe_product_id")
  stripePriceMonthlyId  String?   @map("stripe_price_monthly_id")
  stripePriceYearlyId   String?   @map("stripe_price_yearly_id")
  priceMonthly          Decimal?  @db.Decimal(10, 2) @map("price_monthly")
  priceYearly           Decimal?  @db.Decimal(10, 2) @map("price_yearly")
  maxLocations          Int       @default(1) @map("max_locations")
  maxProducts           Int       @default(50) @map("max_products")
  maxOffers             Int       @default(100) @map("max_offers")
  maxBuyers             Int       @default(50) @map("max_buyers")
  features              Json      @default("[]")
  trialDays             Int       @default(0) @map("trial_days")
  isDefault             Boolean   @default(false) @map("is_default")
  isActive              Boolean   @default(true) @map("is_active")
  sortOrder             Int       @default(100) @map("sort_order")
  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")
  
  // Relations
  businessOwners BusinessOwner[]
  payments       Payment[]
  
  @@map("plans")
}

model Product {
  id            String   @id @default(uuid()) @db.Uuid
  code          String   @unique
  productName   String   @map("product_name")
  species       String[] // PostgreSQL array
  size          String[] // PostgreSQL array
  ownerId       String   @db.Uuid @map("owner_id")
  offerDraftId  Int?     @map("offer_draft_id")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  
  // Relations
  businessOwner BusinessOwner @relation(fields: [ownerId], references: [id])
  offerDraft    OfferDraft?   @relation(fields: [offerDraftId], references: [draftNo])
  
  @@map("products")
}

model SizeBreakup {
  id                  String   @id @default(uuid()) @db.Uuid
  offerDraftProductId String   @db.Uuid @map("offer_draft_product_id")
  size                String
  breakup             Int
  price               Decimal  @db.Decimal(10, 2)
  condition           String?
  sizeDetails         String?  @map("size_details")
  breakupDetails      String?  @map("breakup_details")
  priceDetails        String?  @map("price_details")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  
  // Relations
  offerDraftProduct OfferDraftProduct @relation(fields: [offerDraftProductId], references: [id])
  
  @@map("size_breakups")
}

model Subscription {
  id            String    @id @default(uuid()) @db.Uuid
  userId        String    @db.Uuid @map("user_id")
  subscriptionId String   @unique @map("subscription_id")
  planName      String    @map("plan_name")
  status        SubscriptionStatus @default(trialing)
  paymentStatus PaymentActionStatus @default(unpaid) @map("payment_status")
  startDate     DateTime  @default(now()) @map("start_date")
  endDate       DateTime? @map("end_date")
  maxLocations  Int       @default(0) @map("max_locations")
  maxProducts   Int       @default(0) @map("max_products")
  maxOffers     Int       @default(0) @map("max_offers")
  maxBuyers     Int       @default(0) @map("max_buyers")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  
  // Relations
  user User @relation(fields: [userId], references: [id])
  
  @@map("subscriptions")
}

model UserPlanUsage {
  id            String   @id @default(uuid()) @db.Uuid
  userId        String   @db.Uuid @unique @map("user_id")
  planKey       String?  @map("plan_key")
  usedLocations Int      @default(0) @map("used_locations")
  usedProducts  Int      @default(0) @map("used_products")
  usedOffers    Int      @default(0) @map("used_offers")
  usedBuyers    Int      @default(0) @map("used_buyers")
  lastUpdated   DateTime @default(now()) @map("last_updated")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  
  @@map("UserPlanUsage")
}

// Enums
enum Status {
  active
  inactive
}

enum BuyerStatus {
  active
  inactive
}

enum OfferStatus {
  open
  Open
  Close
  buyer_accepted
  buyer_rejected
  business_owner_accepted
  business_owner_rejected
}

enum DraftStatus {
  open
  close
}

enum PaymentStatus {
  pending
  success
  failed
}

enum PaymentMethod {
  card
  upi
  netbanking
  wallet
}

enum PlanKey {
  trial
  advanced
  basic
  pro
  custom
}

enum BillingCycle {
  monthly
  yearly
}

enum SubscriptionStatus {
  active
  past_due
  canceled
  trialing
  inactive
}

enum PaymentActionStatus {
  paid
  unpaid
  upgrade
  downgrade
}